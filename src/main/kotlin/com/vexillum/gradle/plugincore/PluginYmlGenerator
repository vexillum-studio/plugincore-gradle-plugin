package com.vexillum.gradle.plugincore

import org.gradle.api.DefaultTask
import java.io.File
import org.gradle.api.tasks.Input
import org.gradle.api.tasks.TaskAction

class PluginYmlGenerator : DefaultTask() {

    @Input
    lateinit var pluginName: String

    @Input
    lateinit var author: String

    @Input
    lateinit var mainClass: String

    @Input
    lateinit var version: String

    @Input
    lateinit var apiVersion: String

    @Input
    var outputDir: String = "src/main/resources"

    @TaskAction
    fun generate() {
        val outputFile = project.layout.projectDirectory.file("$outputDir/plugin.yml").asFile
        val templateFile = File(project.rootDir, "buildSrc/resources/plugin.yml.template")
        if (!templateFile.exists()) {
            error("Missing plugin.yml.template in buildSrc/resources")
        }

        val content = templateFile.readText()
            .replace("@PLUGIN_NAME@", pluginName)
            .replace("@AUTHOR@", author)
            .replace("@PLUGIN_MAIN@", mainClass)
            .replace("@VERSION@", version)
            .replace("@API_VERSION@", apiVersion)

        outputFile.writeText(content)
        println("Generated plugin.yml at: ${outputFile.absolutePath}")
    }
}
